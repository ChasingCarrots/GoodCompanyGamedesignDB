{% extends 'helpers/base.html' %}

{% block title %}{{ module.name }} Details{% endblock %}


{% block content %}

    <div class="main_frame">
        <div class="col_frame_left">

            {% if module.features or module.drawbacks %}
            <span class="frame_title" style="background-color:#9b4c77;">{{ module.name }}</span>
            {% else %}
            <span class="frame_title" style="background-color:#90a039;">{{ module.name }}</span>
            {% endif %}

            <div class="sub_frame">
                <table class="frame_helptable" style="background-color:#343434;">
                    <tr>
                        <td class="tooltip" aria-rowspan="3" rowspan="3" width="120">
                            <img height="100" src="/goodcompany/static/img/{{module.icon}}.png">
                            <span class="tooltiptext">{{module.icon}}</span>
                        </td>
                        <td aria-rowspan="3" rowspan="3" width="160">
                            {% for item in module.fields %}
                            <div class="grid_container">
                                {% if item.x == 0 and item.y == 0 %}
                                    <div class="grid_field" style="left:{{item.posx}}px; bottom:{{item.posy}}px; background-color: #4c576a;">
                                    </div>
                                {% else %}
                                    <div class="grid_field" style="left:{{item.posx}}px; bottom:{{item.posy}}px;">
                                    </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </td>
                        <td>
                            <a href="/goodcompany/admin/Production/module/{{module.id}}/">[{{module.id}}] &nbsp;&nbsp;&nbsp; Edit Module Data</a>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <a href="/goodcompany/admin/Production/material/{{material.id}}/">[{{material.id}}] &nbsp;&nbsp;&nbsp; Edit Material Data</a>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            {% if research %}
                                <a href="/goodcompany/admin/Research/developmentproject/{{research.id}}/">[{{research.id}}] &nbsp;&nbsp;&nbsp; Edit Research Project</a>
                            {% endif %}
                        </td>
                    </tr>
                </table>
            </div>
            {% if module.features or module.drawbacks %}
            <span class="frame_footer" style="background-color:#9b4c77;"></span>
            {% else %}
            <span class="frame_footer" style="background-color:#90a039;"></span>
            {% endif %}

            {% if module.features or module.drawbacks %}
            <span class="frame_title">Balancing Information</span>
            <div class="sub_frame">
                <table class="frame_table">
                    <tr>
                        <th width="40%">Category</th>
                        <th width="20%">Total</th>
                        <th width="20%">per Feature</th>
                        <th width="20%">Rating</th>
                    </tr>
                    <tr>
                        <td>Material Cost</td>
                        <td>{{rating.cost|floatformat:1}} G</td>
                        <td>{{rating.feat_cost|floatformat:1}} G</td>
                        <td>{{rating.rating_cost|floatformat:2}}</td>
                    </tr>
                    <tr>
                        <td>Drawbacks</td>
                        <td>{{rating.drawbacks|floatformat:1}}</td>
                        <td>{{rating.feat_drawbacks|floatformat:2}}</td>
                        <td>{{rating.rating_drawbacks|floatformat:2}}</td>
                    </tr>
                    <tr>
                        <td>Fields</td>
                        <td>{{rating.fields}}</td>
                        <td>{{rating.feat_fields|floatformat:2}}</td>
                        <td>{{rating.rating_fields|floatformat:2}}</td>
                    </tr>
                    <tr>
                        <td>Assembly Time</td>
                        <td>{{rating.time|floatformat:1}}s</td>
                        <td>{{rating.feat_time|floatformat:2}}s</td>
                        <td>{{rating.rating_time|floatformat:2}}</td>
                    </tr>
                    <tr>
                        <th>Feature Summary</th>
                        <th>{{rating.features|floatformat:1}}</th>
                        <th></th>
                        <th>{{rating.rating_total|floatformat:2}}</th>
                    </tr>
                </table>
            </div>
            <span class="frame_footer"></span>
            {% endif %}

            {% if module.features or module.drawbacks %}
            <span class="frame_title">Features & Drawbacks</span>
            <div class="sub_frame">
                <table class="frame_table">
                    <tr>
                        <th width="10%">+/-</th>
                        <th width="10%">ID</th>
                        <th width="10%">Emoji</th>
                        <th width="60%">Feature</th>
                        <th width="20%">Value</th>
                    </tr>

                    {% if module.features %}
                        {% for item in module.features %}
                            <tr>
                                <td>ðŸŸ¢</td>
                                <td>{{ item.id }}</td>
                                <td>{{ item.emoji }}</td>
                                <td>{{ item.name }}</td>
                                <td>{{ item.value|floatformat:1 }}</td>
                            </tr>
                        {% endfor %}
                    {% endif %}

                    {% if module.drawbacks %}
                        {% for item in module.drawbacks %}
                            <tr>
                                <td>ðŸ”»</td>
                                <td>{{ item.id }}</td>
                                <td>{{ item.emoji }}</td>
                                <td>{{ item.name }}</td>
                                <td>{{ item.value|floatformat:1 }}</td>
                            </tr>
                        {% endfor %}
                    {% endif %}
                </table>
            </div>
            <span class="frame_footer"></span>
            {% endif %}

            {% if research.data %}
            <span class="frame_title">Data Yield</span>
            <div class="sub_frame">
                <table class="frame_table">
                    <tr>
                        <th width="10%">Icon</th>
                        <th width="10%">ID</th>
                        <th width="50%">Name</th>
                        <th width="15%">Yield</th>
                        <th width="15%">Value</th>
                    </tr>

                    {% for item in research.data %}
                    <tr>
                        <td><img height="30" src="/goodcompany/static/img/{{item.icon}}.png"></td>
                        <td>{{item.id}}<br>
                            <a href="/goodcompany/admin/Research/researchdatatype/{{item.id}}/">edit</a>
                        </td>
                        <td>{{item.name}}</td>
                        <td>{{item.amount}}</td>
                        <td class="tooltip">
                            <span>
                                {{item.value}} G
                                <span class="tooltiptext" style="margin-left: 30px; margin-top: -5px;">
                                    {{item.worth}} G per data point
                                </span>
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
            <span class="frame_footer"></span>
            {% endif %}

            {% if material.usedIn %}
            <span class="frame_title">Used as Material</span>
            <div class="sub_frame">
                <table class="frame_table">
                    <tr>
                        <th width="10%">Icon</th>
                        <th width="10%">ID</th>
                        <th width="80%">Name</th>
                    </tr>

                    {% for item in material.usedIn %}
                    <tr>
                        <td><img height="40" src="/goodcompany/static/img/{{item.icon}}.png"></td>
                        <td>{{item.id}}<br>
                            <a href="/goodcompany/admin/Production/material/{{item.id}}/">edit</a>
                        </td>
                        <td>{{item.name}}<br>
                            <a href="{% url 'moduledetail' item.id %}">View Details</a>
                        </td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
            <span class="frame_footer"></span>
            {% endif %}


        </div>
        <div class="col_frame_right">

            {% if module.features or module.drawbacks %}
            <span class="frame_title" style="background-color:#9b4c77;">Module Overview</span>
            {% else %}
            <span class="frame_title" style="background-color:#90a039;">Module Overview</span>
            {% endif %}

            <div class="sub_frame">
                <table class="frame_table">
                    <tr>
                        <td colspan="2">{{module.category}} ({{module.categoryOrder}})</td>
                        <td colspan="2">{{module.tags}}</td>
                    </tr>
                    <tr>
                        <td width="30%">Stack Size:</td>
                        <td width="20%">{{material.stacksize}}</td>
                        <td width="30%">Batch Size:</td>
                        <td width="20%">{{module.outputAmount}}</td>
                    </tr>
                    <tr>
                        <td>Sell Price:</td>
                        <td>{{module.sellPrice|floatformat:0}} G</td>
                        <td>Demand:</td>
                        <td>{{module.demand}}</td>
                    </tr>
                </table>
            </div>

            {% if module.features or module.drawbacks %}
            <span class="frame_footer" style="background-color:#9b4c77;"></span>
            {% else %}
            <span class="frame_footer" style="background-color:#90a039;"></span>
            {% endif %}


            {% if objects %}
            <span class="frame_title">Crafting Stations</span>
            <div class="sub_frame">
                <table class="frame_table">
                    <tr>
                        <th width="10%">Icon</th>
                        <th width="10%">ID</th>
                        <th width="50%">Name</th>
                        <th width="15%">Batch Time</th>
                        <th width="15%">Item Time</th>
                    </tr>
                    {% for item in objects %}
                        <tr>
                            <td><img height="40" src="/goodcompany/static/img/{{item.icon}}.png"></td>
                            <td>{{ item.id }}<br>
                                <a href="/goodcompany/admin/ObjectTypes/objecttype/{{item.id}}/">Edit</a>
                            </td>
                            <td>{{ item.name }}<br>
                                <a href="{% url 'objectdetailview' item.id %}">View Details</a>
                            </td>
                            <td>{{ item.totalTime }}s</td>
                            <td>{{ item.petItem|floatformat:1 }}s</td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
            <span class="frame_footer"></span>
            {% endif %}

            <span class="frame_title">Recipe</span>
            <div class="sub_frame">
                <table class="frame_table">
                    <tr>
                        <th width="10%">Icon</th>
                        <th width="10%">MatID</th>
                        <th width="10%">ModID</th>
                        <th width="40%">Name</th>
                        <th width="15%">Amount</th>
                        <th width="15%">Cost</th>
                    </tr>
                    {% for item in module.inputMaterials %}
                    <tr>
                        <td><img height="40" src="/goodcompany/static/img/{{item.icon}}.png"></td>
                        <td>{{item.materialID}}<br>
                            <a href="/goodcompany/admin/Production/material/{{item.materialID}}/">edit</a>
                        </td>
                        {% if item.moduleID == -1 %}
                            <td>/</td>
                        {% else %}
                            <td>{{item.moduleID}}<br>
                            <a href="/goodcompany/admin/Production/module/{{item.moduleID}}/">edit</a>
                            </td>
                        {% endif %}
                        <td>{{item.name}}<br>
                        {% if item.moduleID == -1 %}
                            <a href="{% url 'materialdetail' item.materialID %}">View Details</a>
                        {% else %}
                            <a href="{% url 'moduledetail' item.moduleID %}">View Details</a>
                        {% endif %}
                        </td>
                        <td>{{item.amount|floatformat}}</td>
                        <td>{{item.cost|floatformat}} G</td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
            <span class="frame_footer"></span>

            <span class="frame_title">Base Materials</span>
            <div class="sub_frame">
                <table class="frame_table">
                    <tr>
                        <th width="10%">Icon</th>
                        <th width="10%">ID</th>
                        <th width="50%">Name</th>
                        <th width="15%">Amount</th>
                        <th width="15%">Cost</th>
                    </tr>
                    {% for id, item in module.baseMaterials %}
                    <tr>
                        <td><img height="40" src="/goodcompany/static/img/{{item.icon}}.png"></td>
                        <td>{{id}}<br>
                            <a href="/goodcompany/admin/Production/material/{{id}}/">edit</a>
                        </td>
                        <td>{{item.name}}<br>
                            <a href="{% url 'materialdetail' id %}">View Details</a>
                        </td>
                        <td>{{item.amount|floatformat:2}}</td>
                        <td>{{item.totalcost|floatformat:2}} G</td>
                    </tr>
                    {% endfor %}

                    <tr>
                        <th colspan="3">Summary</th>
                        <th>{{module.baseMaterialsAmount|floatformat:2}}</th>
                        <th>{{module.baseMaterialCost|floatformat:2}} G</th>
                    </tr>
                </table>
            </div>
            <span class="frame_footer"></span>


        </div>
    </div>

{% endblock %}

    <br>

    <br>

    <h2 class="ui header">Module Details</h2>
    <table class="ui celled table" style="text-align:center;">
        <thead>
            <tr>
                <th width="10%">OutputAmount</th>
                <th width="10%">Complexity</th>
                <th width="10%">Sell Price</th>
                <th width="10%">Handling Cost</th>
                <th width="10%">Material Cost</th>
                <th width="10%">Slow PreStep-Cost</th>
                <th width="10%">Quick PreStep-Cost</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{module.outputAmount|floatformat:0}}</td>
                <td>[{{module.complexity|floatformat:2}}]</td>
                <td>{{module.income|floatformat:2}} G</td>
                <td>{{module.handlingCost|floatformat:2}} G</td>
                <td>{{module.materialcosts|floatformat:2}} G</td>
                <td>{{module.employeeCostSlow|floatformat:2}} G</td>
                <td>{{module.employeeCostQuick|floatformat:2}} G</td>
            </tr>
        </tbody>
    </table><br>

        Balance Helper
        <table class="ui celled table" style="text-align:center;">
            <thead>
                <tr>
                    <th width="20%">Features</th>
                    <th width="20%">Material Costs</th>
                    <th width="20%">Drawbacks</th>
                    <th width="20%">Module Size</th>
                    <th width="20%">Time Consumption</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{balancing.featureCount|floatformat:1}}</td>
                    <td>{{balancing.materialCosts|floatformat:1}}</td>
                    <td>{{balancing.drawbackCount|floatformat:1}}</td>
                    <td>{{balancing.moduleSize|floatformat:1}}</td>
                    <td>{{balancing.totalTime|floatformat:1}}</td>
                </tr>
            </tbody>
        </table><br>

        <table class="ui celled table" style="text-align:center;">
            <thead>
                <tr>
                    <th width="20%">Total Rating</th>
                    <th width="20%">Cost Rating</th>
                    <th width="20%">Drawback Rating</th>
                    <th width="20%">Size Rating</th>
                    <th width="20%">Time Rating</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{balancing.totalRating|floatformat:1}}</td>
                    <td>{{balancing.featureRating|floatformat:1}}</td>
                    <td>{{balancing.drawbackRating|floatformat:1}}</td>
                    <td>{{balancing.sizeRating|floatformat:1}}</td>
                    <td>{{balancing.timeRating|floatformat:1}}</td>
                </tr>
            </tbody>
        </table><br>

    <h2 class="ui header">Production Tables</h2>
    <table class="ui celled table" style="text-align:center;">
        <thead>
            <tr>
                <th width="10%"></th>
                <th width="20%">Table</th>
                <th width="10%">Time</th>
                <th width="10%">Production</th>
                <th width="10%">Handling</th>
                <th width="10%">Pre-Steps</th>
                <th width="10%">Material</th>
                <th width="10%">Total Cost</th>
            </tr>
        </thead>
        <tbody>
                {% for table in tableList %}
            <tr>
                <td>
                    Slow
                </td>
                <td  rowspan="2">
                    <a href="{% url 'objectdetailview' table.id %}">
                        {{table.name}}
                    </a>
                </td>
                <td  rowspan="2">
                    {{table.productionTime|floatformat:2}}s<br>{{table.productionCost|floatformat:2}} G
                </td>

                <td>
                    {{table.productionRateSlow|floatformat:2}}%
                </td>
                <td>
                    {{table.handlingRateSlow|floatformat:2}}%
                </td>
                <td>
                    {{table.preStepRateSlow|floatformat:2}}%
                </td>
                <td>
                    {{table.materialRateSlow|floatformat:2}}%
                </td>
                <td>
                    {{table.totalCostSlow|floatformat:2}} G
                </td>
            </tr><tr>
                <td>
                    Quick
                </td>

                <td>
                    {{table.productionRateQuick|floatformat:2}}%
                </td>
                <td>
                    {{table.handlingRateQuick|floatformat:2}}%
                </td>
                <td>
                    {{table.preStepRateQuick|floatformat:2}}%
                </td>
                <td>
                    {{table.materialRateQuick|floatformat:2}}%
                </td>
                <td>
                    {{table.totalCostQuick|floatformat:2}} G
                </td>
            </tr>
                {% endfor %}
        </tbody>
    </table><br>




    {% if module.usedinmodulescount > 0 or module.usedinproductcount > 0 %}
    <h2 class="ui header">Used In</h2>
    <table class="ui celled table" style="text-align:center;">
        <thead>
            <tr>
                <th width="15%">Type</th>
                <th width="15%">Count</th>
                <th width="70%">List</th>
            </tr>
        </thead>
        <tbody>
            {% if module.usedinmodulescount > 0 %}
            <tr>
                <td>Modules</td>
                <td>{{module.usedinmodulescount|floatformat:0 }}</td>
                <td>
                    {% for mod in usedinmodules %}
                    <a class='tooltip' href="{% url 'moduledetail' mod.id %}">
                        <img height="40" src="/goodcompany/static/img/{{mod.IconAssetID}}.png" onerror="this.src='/goodcompany/static/img/unknown.png';">
                        <span class='tooltiptext'>{{mod.Name}}</span>
                    </a>
                    {% endfor %}
                </td>
            </tr>
            {% endif %}
        </tbody>
    </table><br>
    {% else %}
    - not used in anything - <br><br>
    {% endif %}


    <h2 class="ui header">Input Materials</h2>
    <table class="ui celled table" style="text-align:center;">
        <thead>
            <tr>
                <th width="15%">Icon</th>
                <th width="35%">Material</th>
                <th width="25%">Amount</th>
                <th width="25%">Total cost</th>
            </tr>
        </thead>
        <tbody>
    {% for material in module.inputMaterials %}
        <tr>
            {% if material.moduleID == -1 %}
            <td>
                <a  href="{% url 'materialdetail' material.materialID %}"><img height="40" src="/goodcompany/static/img/{{material.icon}}.png" onerror="this.src='/goodcompany/static/img/unknown.png';"></a>
            </td>
            <td><a href="{% url 'materialdetail' material.materialID %}">{{ material.name | title}}</a></td>
            {% else %}
            <td>
                <a  href="{% url 'moduledetail' material.moduleID %}"><img height="40" src="/goodcompany/static/img/{{material.icon}}.png" onerror="this.src='/goodcompany/static/img/unknown.png';"></a>
            </td>
            <td><a href="{% url 'moduledetail' material.moduleID %}">{{ material.name | title}}</a></td>
            {% endif %}
            <td>{{ material.amount|floatformat:2 }}</td>
            <td>{{ material.totalcost|floatformat:2 }} G</td>
        </tr>
    {% endfor %}
        </tbody>
    </table><br>

    <h2 class="ui header">Needed Base Materials</h2>
    <table class="ui celled table" style="text-align:center;">
        <thead>
            <tr>
                <th width="15%">Icon</th>
                <th width="35%">Material</th>
                <th width="25%">Amount</th>
                <th width="25%">Total cost</th>
            </tr>
        </thead>
        <tbody>
    {% for materialID, material in materials.items %}
        <tr>
            <td>
                <a  href="{% url 'materialdetail' materialID %}"><img height="40" src="/goodcompany/static/img/{{material.icon}}.png" onerror="this.src='/goodcompany/static/img/unknown.png';"></a>
            </td>
            <td><a href="{% url 'materialdetail' materialID %}">{{ material.name | title}}</a></td>
            <td>{{ material.amount|floatformat:2 }}</td>
            <td>{{ material.totalcost|floatformat:2 }} G</td>
        </tr>
    {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <th></th>
                <th>Total</th>
                <th>{{ total.amount|floatformat:2 }}</th>
                <th>{{ total.totalcost|floatformat:2}} G</th>
            </tr>
        </tfoot>
    </table><br>


    <br><h2 class="ui header">Production Tree</h2>
    <div id="commandoutput" class="ui message" style="padding-bottom: 60px;"></div>
    <br><br><br>


